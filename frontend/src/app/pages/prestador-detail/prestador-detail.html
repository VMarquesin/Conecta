<div class="profile-container">

  @if (prestador$ | async; as prestador) {
    <div class="profile-header">
      <h2>{{ prestador.nomeCompleto }}</h2>
      <p class="fantasia">{{ prestador.nomeFantasia }}</p>
      <p class="bio">{{ prestador.bio }}</p>
      <p class="contato">Contato: {{ prestador.email }}</p>
    </div>
  } @else {
    <p>Carregando perfil...</p>
  }

  <div class="section">
    <h3>Portfólio (Publicações)</h3>

    @if (authService.isLoggedIn$ | async) {
      @if (authService.hasRole('ROLE_PRESTADOR')) {
        <div class="form-container" style="margin-bottom: 2rem; background-color: #f9f9f9;">
          <h4>Adicionar Novo Item ao Portfólio</h4>
          <form [formGroup]="publicacaoForm" (ngSubmit)="onPostarPublicacao()">
            <div class="form-group">
              <label for="titulo">Título</label>
              <input id="titulo" type="text" formControlName="titulo">
              @if (publicacaoForm.get('titulo')?.invalid && publicacaoForm.get('titulo')?.touched) {
                <div class="error-message">Título é obrigatório.</div>
              }
            </div>
            <div class="form-group">
              <label for="descricao">Descrição</label>
              <textarea id="descricao" formControlName="descricao" rows="3"></textarea>
              @if (publicacaoForm.get('descricao')?.invalid && publicacaoForm.get('descricao')?.touched) {
                <div class="error-message">Descrição é obrigatória.</div>
              }
            </div>
            <div class="form-group">
              <label for="fotoUrl">URL da Foto (opcional)</label>
              <input id="fotoUrl" type="text" formControlName="fotoUrl" placeholder="http://exemplo.com/imagem.png">
            </div>
            <button type="submit" [disabled]="publicacaoForm.invalid">Postar</button>
            @if (mensagemSucessoPublicacao) {
              <div class="success-message">{{ mensagemSucessoPublicacao }}</div>
            }
          </form>
        </div>
      }
    }

    <div class="publicacoes-grid">
      @for (pub of (publicacoes$ | async); track pub.id) {
        <div class="pub-card">
          </div>
      } @empty {
        <p>Este prestador ainda não tem publicações.</p>
      }
    </div>
  </div>

  <div class="section">
    <h3>Avaliações</h3>
    
    <div class="avaliacoes-list">
      @for (aval of (avaliacoes$ | async); track aval.id) {
        <div class="aval-card">
          </div>
      } @empty {
        <p>Este prestador ainda não foi avaliado.</p>
      }
    </div>
  </div>

  <div class="section form-container">
    
    @if (authService.isLoggedIn$ | async) {
      @if (authService.hasRole('ROLE_CLIENTE')) {
        <h3>Deixe sua Avaliação</h3>
        <form [formGroup]="avaliacaoForm" (ngSubmit)="onPostarAvaliacao()">
          <div class="form-group">
            <label for="nota">Nota (de 1 a 5)</label>
            <select id="nota" formControlName="nota">
              <option value="5">5 Estrelas</option>
              <option value="4">4 Estrelas</option>
              <option value="3">3 Estrelas</option>
              <option value="2">2 Estrelas</option>
              <option value="1">1 Estrela</option>
            </select>
          </div>
          <div class="form-group">
            <label for="comentario">Comentário</label>
            <textarea id="comentario" formControlName="comentario" rows="4"></textarea>
            @if (avaliacaoForm.get('comentario')?.invalid && avaliacaoForm.get('comentario')?.touched) {
              <div class="error-message">Comentário é obrigatório.</div>
            }
          </div>
          
          <div class="form-group">
            <label for="clienteId">Seu ID de Cliente (para teste)</label>
            <input id="clienteId" type="number" formControlName="clienteId">
            @if (avaliacaoForm.get('clienteId')?.invalid && avaliacaoForm.get('clienteId')?.touched) {
              <div class="error-message">Seu ID de cliente é obrigatório.</div>
            }
          </div>
          <button type="submit" [disabled]="avaliacaoForm.invalid">Postar Avaliação</button>
          @if (mensagemSucesso) {
            <div class="success-message">{{ mensagemSucesso }}</div>
          }
        </form>
      }
    } @else {
      <p>
        Você precisa estar logado para deixar uma avaliação. 
        <a routerLink="/login">Faça o login aqui.</a>
      </p>
    }
  </div>
  
</div> 
